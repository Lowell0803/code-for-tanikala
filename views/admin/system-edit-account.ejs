<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>BulSU Voting System</title>

    <link rel="stylesheet" type="text/css" href="admin/css/index-admin.css" />
    <link rel="stylesheet" type="text/css" href="admin/css/sidebar.css" />
    <link rel="stylesheet" type="text/css" href="admin/css/system-edit-account.css" />

    <!-- Boxicons CDN Link -->
    <link href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=upins:wght@400;700&display=swap" rel="stylesheet" />
  </head>

  <body>
    <%- include('header') %>

    <div class="content">
      <%- include('sidebar', { activeTab: 'system' }) %>
      <main class="main">
        <div class="main-details">
          <div class="main-details-info">
            <h2>Account Details</h2>
            <br />
            <form id="form-details">
              <div>
                <label for="role">Role:</label>
                <input type="text" id="role" placeholder="Role" value="<%= loggedInAdmin.role %>" disabled readonly />
              </div>
              <div>
                <label for="name">Name:</label>
                <input type="text" id="name" placeholder="Name" value="<%= loggedInAdmin.name %>" disabled />
              </div>
              <div>
                <label for="username">Username:</label>
                <input type="text" id="username" placeholder="Username" value="<%= loggedInAdmin.username %>" disabled />
              </div>
              <div>
                <label for="password">Password:</label>
                <input type="password" id="password" placeholder="Password" value="<%= loggedInAdmin.password %>" disabled />
              </div>
              <div>
                <label for="confirm-password">Confirm Password:</label>
                <input type="password" id="confirm-password" placeholder="Confirm Password" value="<%= loggedInAdmin.password %>" disabled />
              </div>
              <br />
              <div>
                <button type="button" id="button-edit">Edit</button>
                <button type="submit" id="button-save" style="display: none">Save</button>
              </div>
            </form>
          </div>
          <div class="main-details-profile">
            <img class="circle-img" id="img-admin" src="<%= loggedInAdmin.img %>" alt="Admin Profile" />
            <p><span><%= loggedInAdmin.name %></span></p>
            <!-- <button id="change-image">Change Profile Image</button> -->
            <br />
            <!-- File input for image upload; using base64 conversion -->
            <input type="file" class="input-file" id="input-file" />
          </div>
        </div>
      </main>
    </div>

    <%- include('footer') %>

    <script>
      // Image upload using base64
      const profileImage = document.getElementById("img-admin");
      const changeImageButton = document.getElementById("change-image");
      const fileInput = document.getElementById("input-file");
      changeImageButton.addEventListener("click", () => {
        fileInput.click();
      });
      fileInput.addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            profileImage.src = e.target.result;
          };
          reader.readAsDataURL(file);
        }
      });
    </script>

    <script>
      // Account edit functionality
      const formDetails = document.getElementById("form-details");
      const editButton = document.getElementById("button-edit");
      const saveButton = document.getElementById("button-save");
      // Select all inputs that are not readonly (do not include role)
      const inputs = formDetails.querySelectorAll("input:not([readonly])");

      editButton.addEventListener("click", () => {
        inputs.forEach((input) => (input.disabled = false));
        saveButton.style.display = "inline-block";
        editButton.style.display = "none";
      });

      formDetails.addEventListener("submit", (event) => {
        event.preventDefault();
        // Gather updated profile data
        const updatedProfile = {
          name: document.getElementById("name").value,
          username: document.getElementById("username").value,
          password: document.getElementById("password").value,
          img: profileImage.src,
        };
        // Send updated data via AJAX (adjust endpoint as needed)
        fetch("/update-account", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(updatedProfile),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              alert("Profile saved!");
              inputs.forEach((input) => (input.disabled = true));
              saveButton.style.display = "none";
              editButton.style.display = "inline-block";
            } else {
              alert("Error saving profile: " + data.error);
            }
          })
          .catch((err) => {
            console.error("Error updating profile:", err);
            alert("Error updating profile.");
          });
      });
    </script>

    <script src="admin/js/sidebar.js"></script>
    <script src="admin/js/index-admin.js"></script>
  </body>
</html>
