<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>BulSU Voting System</title>

    <link rel="stylesheet" type="text/css" href="admin/css/index-admin.css" />
    <link rel="stylesheet" type="text/css" href="admin/css/sidebar.css" />
    <link rel="stylesheet" type="text/css" href="admin/css/dashboard.css" />

    <!-- Boxicons CDN Link -->
    <link href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=upins:wght@400;700&display=swap" rel="stylesheet" />
  </head>

  <body>
    <%- include('header') %>

    <div class="content">
      <%- include('sidebar', { activeTab: 'dashboard' }) %>
      <main class="main">
        <div id="container-overlay">
          <div class="title-container">
            <div class="r">
              <i class="bx bxs-dashboard"></i>
              <h1 class="title">Dashboard</h1>
            </div>
          </div>
          <hr class="title-line" />
          <div class="first-main">
            <div class="main-column">
              <div class="form" id="election-settings">
                <p>
                  <b>Current Election Status: </b>
                </p>
                <br />
                <div class="center">
                  <p>
                    <span>ELECTION ONGOING</span>
                    <span class="separator">|</span>Voting
                  </p>
                </div>
                <br />
                <div>
                  <% if (electionConfig.electionStatus === "Temporarily Closed") { %>
                  <form action="/resume-election" method="POST">
                    <button type="submit" style="background-color: #4caf50; color: #fff">Resume Election</button>
                  </form>
                  <% } else { %>
                  <form action="/temporarily-closed" method="POST">
                    <button type="submit" style="background-color: #f44336; color: #fff">Temporarily Close Election</button>
                  </form>
                  <% } %>
                </div>
              </div>

              <div class="form" id="election-configuration">
                <h3 class="center">Election Configurations</h3>
                <br />
                <% if (electionConfig.electionName) { %>
                <p>
                  <b>Election Name:</b>
                  <span><%= electionConfig.electionName %></span>
                </p>
                <% } else { %>
                <p><b>Election Name:</b> <span>Not set</span></p>
                <% } %>
                <br />

                <p><b>Registration Period:</b></p>
                <% if (electionConfig.registrationStart && electionConfig.registrationEnd) { %>
                <p>
                  &nbsp;&nbsp;Start Date:
                  <span><%= new Date(electionConfig.registrationStart).toLocaleString() %></span>
                </p>
                <p>
                  &nbsp;&nbsp;End Date:
                  <span><%= new Date(electionConfig.registrationEnd).toLocaleString() %></span>
                </p>
                <% } else { %>
                <p>Registration dates not set.</p>
                <% } %>
                <br />

                <p><b>Voting Period:</b></p>
                <% if (electionConfig.votingStart && electionConfig.votingEnd) { %>
                <p>
                  &nbsp;&nbsp;Start Date:
                  <span><%= new Date(electionConfig.votingStart).toLocaleString() %></span>
                </p>
                <p>
                  &nbsp;&nbsp;End Date:
                  <span><%= new Date(electionConfig.votingEnd).toLocaleString() %></span>
                </p>
                <% } else { %>
                <p>Voting dates not set.</p>
                <% } %>
                <br />

                <% if (electionConfig.totalElections) { %>
                <p><b>Total Number of Elections:</b> <span><%= electionConfig.totalElections %></span></p>
                <% } %>
                <br />

                <% if (electionConfig.totalPartylists) { %>
                <p><b>Total Number of Party Lists:</b> <span><%= electionConfig.totalPartylists %></span></p>
                <% } else { %>
                <p><b>Total Number of Party Lists:</b> <span>0</span></p>
                <% } %> <% if (electionConfig.partylists && electionConfig.partylists.length > 0) { %>
                <ul class="election-configuration">
                  <% electionConfig.partylists.forEach(function(party) { %>
                  <li><%= party %></li>
                  <% }); %>
                </ul>
                <% } else { %>
                <p>No party lists available.</p>
                <% } %>
                <br />

                <% if (electionConfig.totalCandidates) { %>
                <p><b>Total Number of Candidates:</b> <span><%= electionConfig.totalCandidates %></span></p>
                <% } else { %>
                <p><b>Total Number of Candidates:</b> <span>0</span></p>
                <% } %>
                <br />

                <% if (electionConfig.totalStudents) { %>
                <p><b>Total Number of Voters:</b> <span><%= electionConfig.totalStudents %></span></p>
                <% } else { %>
                <p><b>Total Number of Voters:</b> <span>0</span></p>
                <% } %>
                <br />

                <% if (electionConfig.listOfElections && electionConfig.listOfElections.length > 0) { %>
                <p><b>List of Elections and Their Number of Students (Voters):</b></p>
                <br />
                <ol class="election-configuration">
                  <% electionConfig.listOfElections.forEach(function(elec) { %>
                  <li>
                    <p>
                      <b><%= elec.name %>:</b>
                      <span><%= elec.voters ? elec.voters + " students" : "No data" %></span>
                    </p>
                  </li>
                  <% }); %>
                </ol>
                <% } else { %>
                <p>No elections data available.</p>
                <% } %>
                <br />
                <br />
                <div class="center">
                  <a href="settings_election_management.html">Go to Election Management</a>
                </div>
              </div>
            </div>

            <div class="right-side">
              <div class="beside">
                <% let totalRegisteredVoters = 0; let totalVoted = 0; let totalVoters = 0; if (electionConfig.listOfElections && electionConfig.listOfElections.length) { electionConfig.listOfElections.forEach(college => { totalRegisteredVoters += college.registeredVoters; totalVoted += college.numberOfVoted; totalVoters += college.voters; }); } let turnoutPercentage = totalVoters > 0 ? (totalVoted / totalVoters * 100) : 0; %>

                <div class="form" id="registered-students">
                  <h4 class="center">Number of Registered Voters</h4>
                  <p class="center"><%= totalRegisteredVoters %></p>
                </div>
                <div class="form" id="voter-turnout">
                  <h4 class="center">Voter Turnout</h4>
                  <p class="center"><%= turnoutPercentage.toFixed(2) %>%</p>
                </div>
              </div>

              <div class="form" id="blockchain-management">
                <h3 class="center">Blockchain Management</h3>
                <br />
                <p><b>Smart Contract Status: </b>Not Deployed | Deployed</p>
                <br />
                <p><b>No. of Smart Contracts Deployed: </b><span> 1</span></p>
                <p><b>Smart Contract Address: </b><span>No data available yet.</span></p>
                <br />
                <p><b>No. of Vote Transactions: </b><span>7000</span></p>
                <p><b>Blockchain Link: </b>No data available yet.</p>
                <br />
                <p><b>Total No. of Blockchain Transactions: </b><span>7001</span></p>
                <br />
                <hr />
                <br />
                <h3 class="center">Admin Wallet & Fund Management</h3>
                <br />
                <p><b>Username (Public Key): </b><span>No data available yet.</span></p>
                <br />
                <p><b>Current Fund: </b><span>₱50,000</span></p>
                <br />
                <p><b>Total Deposit: </b><span>₱100,000</span></p>
                <p><b>Last Deposit Date: </b><span>February 18, 2025 - 5:05 PM</span></p>
                <br />
                <p><b>Total Expense: </b><span>₱50,000</span></p>
                <p><b>Last Expense Date: </b><span>February 18, 2025 - 5:05 PM</span></p>
                <br />
                <div class="button-container">
                  <a href="">Fund Wallet on Binance</a>
                </div>
                <br />
                <p><b>Live Transaction Fee Estimate: </b><span>No data available yet.</span></p>
                <br />
                <p><b>Recommended Fund Estimate: </b><span>No data available yet.</span></p>
              </div>

              <div class="form" id="quick-actions">
                <h3>Quick Actions</h3>
              </div>

              <div class="quick-actions-container">
                <div class="quick-actions-buttons">
                  <img class="quick-buttons" src="../img/election-results.png" alt="Election Results" />
                  <p>Election Results</p>
                  <div class="view-export">
                    <a href="results.html">View</a>
                    <span class="separator">|</span>
                    <a href="export-election-results">Export</a>
                  </div>
                </div>

                <div class="quick-actions-buttons">
                  <img class="quick-buttons" src="../img/candidates.png" alt="Candidates" />
                  <p>Candidates</p>
                  <div class="view-export">
                    <a href="candidates">View</a>
                    <span class="separator">|</span>
                    <a href="export-candidates">Export</a>
                  </div>
                </div>

                <div class="quick-actions-buttons">
                  <img class="quick-buttons" id="voter-info-button" src="../img/voter-info.png" alt="Voter Information" />
                  <p>Voter Info</p>
                  <div class="view-export">
                    <a href="voter_information.html">View</a>
                    <span class="separator">|</span>
                    <a href="export-voter-info">Export</a>
                  </div>
                </div>

                <div class="quick-actions-buttons">
                  <img class="quick-buttons" id="admin-button" src="../img/admin-accounts.png" alt="Admin Accounts" />
                  <p>Admin Accounts</p>
                  <div class="view-export">
                    <a href="manage-accounts.html">View</a>
                    <span class="separator">|</span>
                    <a href="export-admin-accounts">Export</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <%- include('footer') %>

    <script src="admin/js/sidebar.js"></script>
    <script src="admin/js/index-admin.js"></script>
    <!-- <script>
      // Ensure currentPeriod exists to avoid errors
      if (!electionConfig.currentPeriod) {
        electionConfig.currentPeriod = { name: "N/A", duration: "N/A", waitingFor: null };
      }
      // Set current phase info in header
      document.getElementById("currentPeriodDisplay").innerText = electionConfig.currentPeriod.name;
      document.getElementById("currentPeriodDuration").innerText = electionConfig.currentPeriod.duration;
    </script> -->
    <script src="admin/js/index-admin.js"></script>
    <script src="js/dropdown.js"></script>
  </body>
</html>
