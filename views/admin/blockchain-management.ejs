<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>BulSU Voting System</title>

    <link rel="stylesheet" type="text/css" href="admin/css/index-admin.css" />
    <link rel="stylesheet" type="text/css" href="admin/css/sidebar.css" />
    <link rel="stylesheet" type="text/css" href="admin/css/blockchain-management.css" />

    <!-- Boxicons CDN Link -->
    <link href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=upins:wght@400;700&display=swap" rel="stylesheet" />

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  </head>

  <body>
    <%- include('header') %>

    <div class="content">
      <%- include('sidebar', { activeTab: 'blockchain' }) %>
      <main class="main">
        <div id="container-overlay">
          <div class="title-container">
            <div class="r">
              <i class="fa fa-link"></i>
              <h1 class="title">Blockchain Management</h1>
            </div>
          </div>
          <hr class="title-line" />
          <div class="page-title">
            <div class="blockchain">
              <h4>
                Blockchain Link:
                <span>
                  <% if (blockchainInfo && blockchainInfo.blockchainLink) { %>
                  <a href="<%= blockchainInfo.blockchainLink %>" target="_blank">Amoy PolygonScan</a>
                  <% } else { %> N/A <% } %>
                </span>
              </h4>
            </div>
            <div class="smart">
              <h4>Candidates Submitted to Blockchain: <%= candidateSubmission ? "Yes" : "No" %></h4>
            </div>
          </div>
          <div class="first-main">
            <div class="left">
              <h2>Wallet Information</h2>
              <!-- Wallet Address -->
              <p><strong>Wallet Address:</strong> <%= walletInfo ? walletInfo.address : "N/A" %></p>
              <!-- Wallet Balance (in POL) -->
              <p><strong>Wallet Balance (POL):</strong> <%= walletInfo ? walletInfo.balancePOL.toFixed(4) : "N/A" %></p>
              <!-- Wallet Balance (in PHP) -->
              <p><strong>Wallet Balance (PHP):</strong> <%= walletInfo && walletInfo.balancePHP ? walletInfo.balancePHP.toFixed(2) : "N/A" %></p>
              <!-- Wallet Balance (in USD) -->
              <p><strong>Wallet Balance (USD):</strong> <%= walletInfo && walletInfo.balanceUSD ? walletInfo.balanceUSD.toFixed(2) : "N/A" %></p>
              <!-- Last update of data -->
              <p><strong>Last Update:</strong> <%= walletInfo ? walletInfo.updatedAt.toLocaleString() : "N/A" %></p>
              <hr />
            </div>
            <div class="right">
              <!-- Last Submission of Candidates Date -->
              <p>
                <strong>Last Submission Date:</strong>
                <%= blockchainInfo && blockchainInfo.dateSent ? new Date(blockchainInfo.dateSent).toLocaleString() : "N/A" %>
              </p>
              <!-- Gas Used -->
              <p><strong>Gas Used:</strong> <%= blockchainInfo ? blockchainInfo.gasUsed : "N/A" %></p>
              <!-- Amount Spent (in Wei) -->
              <p><strong>Amount Spent (Wei):</strong> <%= blockchainInfo ? blockchainInfo.amountSpentWei : "N/A" %></p>
              <!-- Amount Spent (in POL) -->
              <p><strong>Amount Spent (POL):</strong> <%= blockchainInfo ? blockchainInfo.amountSpentEth : "N/A" %></p>
              <!-- Amount Spent (in PHP) -->
              <p><strong>Amount Spent (PHP):</strong> <%= blockchainInfo && blockchainInfo.amountSpentPhp ? blockchainInfo.amountSpentPhp.toFixed(2) : "N/A" %></p>
              <!-- Amount Spent (in USD) -->
              <p><strong>Amount Spent (USD):</strong> <%= blockchainInfo && blockchainInfo.amountSpentUsd ? blockchainInfo.amountSpentUsd.toFixed(2) : "N/A" %></p>
              <!-- Transaction Hash -->
              <p><strong>Transaction Hash:</strong> <%= blockchainInfo ? blockchainInfo.transactionHash : "N/A" %></p>
            </div>
          </div>
        </div>
      </main>
    </div>

    <%- include('footer') %>

    <script src="admin/js/sidebar.js"></script>
    <script src="admin/js/index-admin.js"></script>
    <script src="js/dropdown.js"></script>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      // Connect to Socket.IO, passing the logged-in admin's email
      const socket = io("/", { query: { email: "<%= loggedInAdmin.email %>" } });
    </script>
  </body>
</html>
