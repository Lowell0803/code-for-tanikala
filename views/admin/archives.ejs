<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>BulSU Voting System</title>

    <link rel="stylesheet" type="text/css" href="admin/css/index-admin.css" />
    <link rel="stylesheet" type="text/css" href="admin/css/sidebar.css" />
    <link rel="stylesheet" type="text/css" href="admin/css/archives.css" />

    <!-- Boxicons CDN Link -->
    <link href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=upins:wght@400;700&display=swap" rel="stylesheet" />
  </head>

  <body>
    <%- include('header') %>

    <div class="content">
      <%- include('sidebar', { activeTab: 'archives' }) %>
      <main class="main">
         <div class="title-container">
          <div class="r">
             <i class="bx bx-archive"></i>
            <h1 class="title">Election Archives</h1>
          </div>
        </div>
        <hr class="title-line" />
        <div class="first-main">

        <section class="archive-list">
          <% if (archives && archives.length > 0) { %>
          <table>
            <thead>
              <tr>
                <th class="no">No.</th>
                <th>Election Name</th>
                <th>Registration Period</th>
                <th>Voting Period</th>
                <th>Election Status</th>
                <!-- New column for exporting candidate data -->
                <th>Election Details</th>
                <th>Candidates</th>
                <th>Voter Turnout</th>
                <th>Vote Tally</th>
                <th>Blockchain Details</th>
                <th>Archived At</th>
              </tr>
            </thead>
            <tbody>
              <% archives.forEach(function(archive) { %>
              <tr>
                <td><%= archive.no %></td>
                <td><%= archive.electionName %></td>
                <td><%= archive.registrationStart ? new Date(archive.registrationStart).toLocaleString() : "N/A" %> - <%= archive.registrationEnd ? new Date(archive.registrationEnd).toLocaleString() : "N/A" %></td>
                <td><%= archive.votingStart ? new Date(archive.votingStart).toLocaleString() : "N/A" %> - <%= archive.votingEnd ? new Date(archive.votingEnd).toLocaleString() : "N/A" %></td>
                <td><%= archive.electionStatus %></td>
                <!-- Export button/link -->
                <td>
                  <a href="/api/export-archive/<%= archive._id %>" target="_blank">Export</a>
                </td>
                <td>
                  <a href="/api/export-archive/<%= archive._id %>" target="_blank">Export</a>
                </td>
                <td>
                  <a href="/api/export-archive/<%= archive._id %>" target="_blank">Export</a>
                </td>
                <td>
                  <a href="/api/export-archive/<%= archive._id %>" target="_blank">Export</a>
                </td>
                <td>
                  <a href="/api/export-archive/<%= archive._id %>" target="_blank">Export</a>
                </td>
                 <td><%= archive.archivedAt ? new Date(archive.archivedAt).toLocaleString() : "N/A" %></td>
              </tr>
              <% }); %>
            </tbody>
          </table>
          <% } else { %>
          <p>No archived elections found.</p>
          <% } %>
        </section>
      </main>
    </div>

    <%- include('footer') %>

    <script src="admin/js/sidebar.js"></script>
    <script src="admin/js/index-admin.js"></script>
    <script src="admin/js/dropdown.js"></script>
  </body>
</html>
