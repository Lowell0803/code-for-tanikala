<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Voting Receipt</title>
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <link rel="stylesheet" type="text/css" href="voter/css/index-voter.css" />
    <link rel="stylesheet" type="text/css" href="voter/css/verify.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Poppins:wght@400;700&display=swap" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <style>
      /* Ensure long hashes break properly */
      .hash-break {
        word-break: break-all;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-logo">
        <img src="/img/logo_tanikala.png" alt="Tanikala Voting System" />
      </div>
      <nav class="header-nav">
        <ul class="header-nav-content">
          <li>Vote</li>
          <p>|</p>
          <li>Review</li>
          <p>|</p>
          <li id="active-link">Verify</li>
          <div class="dropdown">
            <div class="settings">
              <i class="fa-solid fa-user"></i>
              <button class="dropdown-toggle">
                <i class="fas fa-caret-down"></i>
              </button>

              <div class="dropdown-menu">
                <a href="#">Logged in as <span>Microsoft Email</span></a>
                <a href="/voter/logout">Log Out</a>
              </div>
            </div>
          </div>
        </ul>
      </nav>
      <div class="header-bottom-line"></div>
    </header>

    <!-- Receipt Container -->
    <div class="content">
      <br />
      <div class="main-first">
        <img src="img/logo_bulsu.png" class="main-first-logo" alt="BulSU Logo" />
        <div class="first-text">
          <h2 class="title">BulSU Student Government Elections<br />2025 - 2026</h2>
        </div>
        <img src="img/logo_bulsu_ucse.png" class="main-first-logo" alt="BulSU UCSE Logo" />
      </div>

      <!-- Wrap the receipt in a container for exporting -->
      <!-- <div class="content-main receipt-container" style="padding: 20px; border: 1px solid #ccc"> -->
      <div class="content-main receipt-container">
        <div class="verify">
          <div class="row">
            <div class="column">
              <div class="d-flex">
                <img src="/img/logo_tanikala.png" />
              </div>
              <br />
              <div class="d-flex justify-content-between">
                <strong>Tanikala Voting System</strong>
                <strong>Student Copy</strong>
              </div>
              <div class="d-flex flex-col justify-content-center">
                <h2 class="align-center title">Voting Receipt</h2>
              </div>
              <br />
              <hr />
              <br />
              <!-- Voting Hash with auto-break -->
              <div class="d-flex flex-col justify-content-center">
                <h4>
                  Voter ID: <br />
                  <span class="hash-break"><%= voterHash %></span>
                </h4>
              </div>
              <br />
              <!-- Table with candidate selections -->
              <table>
                <thead>
                  <tr>
                    <th scope="col left">Position</th>
                    <th scope="col right" colspan="2">Candidate(s)</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- President -->
                  <tr>
                    <td data-label="Position">President</td>
                    <td data-label="Candidate" colspan="2">Zarina B. Dungo – BulSUONE</td>
                  </tr>
                  <!-- Vice President -->
                  <tr>
                    <td data-label="Position">Vice President</td>
                    <td data-label="Candidate" colspan="2">Yvan Lowell T. Aquino – KASAMA – BulSU</td>
                  </tr>
                  <!-- Senator(s) -->
                  <tr>
                    <td data-label="Position">Senator(s)</td>
                    <td data-label="Candidate" colspan="2">Zarina B. Aquino – KASAMA – BulSU, Zarina B. Aquino – KASAMA – BulSU</td>
                  </tr>
                  <!-- Governor -->
                  <tr>
                    <td data-label="Position">Governor</td>
                    <td data-label="Candidate" colspan="2">Brandon L. Cruz – BulSUONE</td>
                  </tr>
                  <!-- Vice Governor -->
                  <tr>
                    <td data-label="Position">Vice Governor</td>
                    <td data-label="Candidate" colspan="2">Derek F. Ramirez – BulSUONE</td>
                  </tr>
                  <!-- Board Member -->
                  <tr>
                    <td data-label="Position">Board Member</td>
                    <td data-label="Candidate" colspan="2">Quentin S. Morales – KASAMA – BulSU</td>
                  </tr>
                </tbody>
              </table>
              <hr />
              <br />
              <!-- College and Program Details -->
              <div class="d-flex justify-content-between">
                <strong>College</strong>
                <!-- College acronym displayed then replaced on client-side -->
                <span id="collegeDisplay"><%= voterCollege %></span>
              </div>
              <hr />
              <div class="d-flex justify-content-between">
                <strong>Program</strong>
                <span><%= voterProgram %></span>
              </div>
              <br />
              <hr />
              <!-- Transaction Confirmation -->
              <div class="d-flex flex-col">
                <span>Votes Submitted To Blockchain</span>
                <span>
                  Transaction Hash:
                  <span class="hash-break"><%= txHash %></span>
                </span>
                <span>Thank You.</span>
              </div>
              <br />
              <div class="d-flex">
                <span>Date:</span>
                <span><%= new Date().toLocaleString() %></span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Export Button -->
      <div style="text-align: center; margin: 20px">
        <button id="exportBtn" style="border-radius: 6px; padding: 10px 20px; font-size: 16px" class="button-save">Export Receipt as Image</button>
      </div>
    </div>

    <footer class="footer">
      <div class="footer-left">
        <img src="img/calendar.png" class="footer-img" />
        <p id="datetime" data-date="<%= electionConfig.fakeCurrentDate %>"></p>
      </div>

      <div class="footer-center">
        <img src="img/copyright.png" class="footer-img" id="copyright-img" />
        <p>2025 - Fourmula 1</p>
      </div>
      <div class="footer-right"></div>
    </footer>

    <!-- Load html-to-image from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/html-to-image@1.10.3/dist/html-to-image.min.js"></script>

    <!-- Client-side mapping for full college name and export functionality -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Mapping for college acronym to full name
        var collegeMap = {
          CAFA: "College of Architecture and Fine Arts",
          CAL: "College of Arts and Letters",
          CBEA: "College of Business Education and Accountancy",
          CCJE: "College of Criminal Justice Education",
          COE: "College of Engineering",
          COED: "College of Education",
          CHTM: "College of Hospitality and Tourism Management",
          CIT: "College of Industrial Technology",
          CICT: "College of Information and Communications Technology",
          CON: "College of Nursing",
          CS: "College of Science",
          CSSP: "College of Social Sciences and Philosophy",
          CSER: "College of Sports, Exercise, and Recreation",
        };
        var collegeElem = document.getElementById("collegeDisplay");
        if (collegeElem) {
          var acronym = collegeElem.textContent.trim();
          collegeElem.textContent = collegeMap[acronym] || acronym;
        }

        // Export Receipt as Image using html-to-image
        document.getElementById("exportBtn").addEventListener("click", function () {
          htmlToImage
            .toPng(document.querySelector(".receipt-container"))
            .then(function (dataUrl) {
              var link = document.createElement("a");
              link.download = "receipt.png";
              link.href = dataUrl;
              link.click();
            })
            .catch(function (error) {
              console.error("Oops, something went wrong!", error);
            });
        });
      });
    </script>

    <script>
      function formatDate(isoString) {
        const date = new Date(isoString);
        const options = {
          month: "long",
          day: "2-digit",
          year: "numeric",
          hour: "2-digit",
          minute: "2-digit",
          hour12: true,
        };
        return date.toLocaleString("en-US", options).toUpperCase();
      }

      function updateDateTime() {
        const datetimeElement = document.getElementById("datetime");
        if (!datetimeElement) return;

        // Get the initial time from the data attribute
        let currentTime = new Date(datetimeElement.getAttribute("data-date"));

        function update() {
          datetimeElement.textContent = formatDate(currentTime);
          currentTime.setMinutes(currentTime.getMinutes() + 1); // Increment by 1 minute
        }

        update(); // Set initial formatted date
        setInterval(update, 60000); // Update every minute (60000ms)
      }

      document.addEventListener("DOMContentLoaded", updateDateTime);
    </script>
    <script src="js/index.js"></script>
  </body>
</html>
