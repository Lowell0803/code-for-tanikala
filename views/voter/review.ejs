<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Voting System</title>

    <link rel="stylesheet" type="text/css" href="voter/css/index_voter.css" />
    <link rel="stylesheet" type="text/css" href="voter/css/review.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Poppins:wght@400;700&display=swap" rel="stylesheet" />
  </head>

  <body>
    <header class="header">
      <div class="header-logo">
        <img src="img/logo_tanikala.png" alt="Tanikala Voting System" />
      </div>
      <nav class="header-nav">
        <ul class="header-nav-content">
          <li><a href="/vote">Vote</a></li>
          <li><a href="/review" id="active-link">Review</a></li>
          <li><a href="verify.html">Verify</a></li>
        </ul>
      </nav>
      <div class="header-bottom-line"></div>
    </header>

    <div class="content">
      <div class="content-header">
        <div class="content-header-bulsu">
          <img src="img/logo_bulsu.png" />
        </div>
        <div class="content-header-text">
          <h1>BulSU Student Government Elections<br />S.Y. 2025 - 2026</h1>
        </div>
        <div class="content-header-ucse">
          <img src="img/logo_bulsu_ucse.png" />
        </div>
      </div>

      <div class="content-main">
        <div class="review">
          <br />
          <h3 class="blue-background">Vote Summary</h3>
          <br />
          <h3 class="red-background">BulSU Supreme Student Council S.Y. 2025-2026</h3>
          <br />
          <ul>
            <li><b>President:</b> <span><%= votes.president.name %></span></li>
            <li><b>Vice President:</b> <span><%= votes.vicePresident.name %></span></li>
            <li>
              <b>Senators:</b>
              <div>
                <% votes.senator.forEach((senator) => { %>
                <span><%= senator.name %></span><br />
                <% }); %>
              </div>
            </li>
            <li><b>Governor:</b> <span><%= votes.governor.name %></span></li>
            <li><b>Vice Governor:</b> <span><%= votes.viceGovernor.name %></span></li>
            <li><b>Board Member:</b> <span><%= votes.boardMember.name %></span></li>
          </ul>
          <form id="voteForm">
            <input type="hidden" id="voteData" value="<%= JSON.stringify(votes) %>" />
            <input type="button" value="Submit Votes to Blockchain" onclick="submitVote()" />
          </form>

          <!-- <script>
            async function submitVote() {
              const votes = JSON.parse(document.getElementById("voteData").value);
              console.log("Submitting votes:", votes);

              try {
                const response = await fetch("/submit-vote", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ votes }),
                });

                const data = await response.json();
                alert(data.message);
              } catch (error) {
                console.error("Error submitting vote:", error);
                alert("Failed to submit votes.");
              }
            }
          </script> -->

          <script>
            async function submitVote() {
              let votes = JSON.parse(document.getElementById("voteData").value);
              console.log("üì° Original votes:", votes);

              // ‚úÖ Get logged-in voter's college and program (Ensure these values exist)
              const voterCollege = "<%= voterCollege %>"; // Example: "CAFA"
              const voterProgram = "<%= voterProgram %>"; // Example: "Bachelor of Fine Arts Major in Visual Communication"

              // ‚úÖ Reformat LSC votes before submission
              let formattedVotes = {};

              // ‚úÖ Main positions (President, Vice President, Senator) remain the same
              formattedVotes["President"] = votes.president;
              formattedVotes["Vice President"] = votes.vicePresident;
              formattedVotes["Senator"] = votes.senator;

              // ‚úÖ Fix LSC Positions (Governor & Vice Governor should use "Governor - CollegeAcronym")
              if (votes.governor) {
                formattedVotes[`Governor - ${voterCollege}`] = votes.governor;
              }
              if (votes.viceGovernor) {
                formattedVotes[`Vice Governor - ${voterCollege}`] = votes.viceGovernor;
              }

              // ‚úÖ Fix Board Member (Should use "Board Member - Program Name")
              if (votes.boardMember) {
                formattedVotes[`Board Member - ${voterProgram}`] = votes.boardMember;
              }

              console.log("üì° Reformatted votes:", formattedVotes);

              try {
                const response = await fetch("/submit-vote", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ votes: formattedVotes }),
                });

                const data = await response.json();
                alert(data.message);
              } catch (error) {
                console.error("‚ùå Error submitting vote:", error);
                alert("Failed to submit votes.");
              }
            }
          </script>
        </div>
      </div>
    </div>

    <div class="footer">
      <div class="footer-left">
        <p>OCTOBER 23, 2024 - 04:17 AM</p>
      </div>
      <div class="footer-right">
        <p>¬© 2024 - Fourmula 1</p>
      </div>
    </div>

    <script></script>
  </body>
</html>
